{% extends "base.html" %}
{% block title %}Foto - Superdegen{% endblock %}
{% set page = "photo-view" %}
{% block content %}

<div style="padding: 16px; text-align: center;">
  <img src="{{ photo.url }}" alt="" style="max-width: 100%; border-radius: 14px;">
</div>

<div style="padding: 14px; text-align:center;">
  <p id="caption" style="opacity:.8; cursor:pointer;">
    {{ photo.caption or "Adicionar legenda..." }}
  </p>
  <input id="caption-input" style="display:none; width:100%; padding:6px; border-radius:8px;">
</div>

{% endblock %}

{% block scripts %}
<script type="module">
import { api } from "/static/js/main.js";

const photoId = {{ photo.id | tojson }};
const caption = document.getElementById("caption");
const input = document.getElementById("caption-input");

caption.addEventListener("click", () => {
  input.value = caption.textContent.trim();
  caption.style.display = "none";
  input.style.display = "block";
  input.focus();
});

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    api(`/photo/${photoId}/caption`, { method:"POST", body:{ caption: input.value } })
      .then(() => {
        caption.textContent = input.value || "Adicionar legenda...";
        caption.style.display = "block";
        input.style.display = "none";
      });
  }
});
</script>
{% endblock %}
